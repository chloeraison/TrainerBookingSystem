@page "/Clients"
@model TrainerBookingSystem.Web.Pages.ClientsModel
@{
    ViewData["Title"] = "Clients";
}

<section class="card">
  <h2>ðŸ‘¥ Clients</h2>

  <table class="client-table slim">
    <thead>
      <tr>
        <th>Name</th>
        <th class="col-sessions">Sessions</th>
      </tr>
    </thead>
    <tbody>
    @foreach (var c in Model.Clients)
    {
        var pref = string.IsNullOrWhiteSpace(c.PreferredTime)
            ? null
            : c.PreferredTime.Split(',', StringSplitOptions.TrimEntries | StringSplitOptions.RemoveEmptyEntries)
                              .FirstOrDefault();

        var total = (c.SessionsLeft + c.SessionsCompleted);
        var pct   = total > 0 ? (int)Math.Round(100.0 * c.SessionsCompleted / total) : 0;

        <tr>
          <td class="name">
            <a asp-page="/Details" asp-route-id="@c.Id">@c.Name</a>
            <div class="meta">
              @if (!string.IsNullOrWhiteSpace(c.Gym)) { <span class="chip chip-muted">@c.Gym</span> }
              @if (!string.IsNullOrEmpty(pref))       { <span class="chip chip-blue">@pref</span> }
            </div>
          </td>

          <td class="col-sessions">
            <div class="pills">
              <span class="pill pill-green" title="Left">@c.SessionsLeft</span>
              <span class="pill pill-muted" title="Completed">@c.SessionsCompleted</span>
            </div>
            <div class="mini-progress" aria-label="Completion">
              <span style="width:@pct%"></span>
            </div>
          </td>
        </tr>
    }
    </tbody>
  </table>
</section>
